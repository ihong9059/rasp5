# 번호판 인식 개선 리포트

## 1. 수정된 내용 (현재 적용됨)

### 1.1 텍스트 병합 로직 추가
**파일**: `plate_recognizer.py:86-163`

**문제**: EasyOCR이 번호판을 여러 조각으로 인식
```
"201" (100%), "누" (99.54%), "2734" (92.39%)
```

**해결**: `merge_nearby_texts()` 함수 추가
- 같은 라인(y좌표 유사)에 있는 텍스트 감지
- 인접한(x좌표 거리 가까운) 텍스트만 병합
- 2개 또는 3개 텍스트 조합 시도

### 1.2 번호판 패턴 수정
**파일**: `plate_recognizer.py:11-19`

**변경 전**:
```python
r'\d{2,4}[-\s]?\d{2,4}'  # 숫자만 (외국 번호판)
```

**변경 후**: 제거됨 (한글 포함 필수)
- "2026" 같은 날짜가 번호판으로 오인식되는 문제 해결

### 1.3 전체 이미지 OCR
**파일**: `plate_recognizer.py:170-172`

**변경 전**: `find_plate_region()`으로 영역 검출 → 해당 영역만 OCR

**변경 후**: 전체 이미지에서 OCR 수행

**이유**: 모니터 화면 촬영 시 잘못된 영역이 검출되어 번호판을 놓치는 문제

### 1.4 JSON 직렬화 오류 수정
**파일**: `plate_recognizer.py:72-77`

```python
# numpy int32/float64 → Python int/float 변환
bbox_converted = [[int(p[0]), int(p[1])] for p in bbox]
'confidence': float(confidence)
```

### 1.5 UI 개선 (캡처 즉시 고정)
**파일**: `app.py`, `static/js/main.js`

**변경 전**: Capture → OCR 완료 → 이미지 고정

**변경 후**: Capture → **즉시 이미지 고정** → OCR 처리 → 결과 표시

---

## 2. 추가 개선 가능한 부분

| 영역 | 현재 상태 | 개선 방안 | 예상 효과 |
|------|----------|----------|----------|
| **이미지 전처리** | 기본 CLAHE만 적용 | 적응형 이진화, 노이즈 제거 강화 | 신뢰도 10-20% 향상 |
| **번호판 영역 검출** | 컨투어 기반 (비활성화됨) | YOLO/SSD 딥러닝 모델 | 정확도 대폭 향상 |
| **OCR 엔진** | EasyOCR (범용) | 번호판 특화 모델 학습 | 인식률 향상 |
| **처리 속도** | CPU만 사용 | GPU 활용 (CUDA) | 5-10배 빨라짐 |
| **다중 번호판** | 첫 번째만 인식 | 모든 번호판 검출 | 여러 차량 동시 인식 |

---

## 3. 개선 작업 수행 위치

```
plate_recognizer.py
├── __init__()           # 패턴 정의, OCR 엔진 설정
├── preprocess_image()   # ⭐ 이미지 전처리 개선
├── find_plate_region()  # ⭐ 번호판 영역 검출 개선
├── extract_plate_text() # OCR 수행
├── merge_nearby_texts() # 텍스트 병합
├── validate_plate()     # ⭐ 패턴 매칭 개선
└── recognize()          # 메인 로직
```

---

## 4. 권장 개선 순서

1. **preprocess_image()** - 가장 쉽고 효과적
2. **validate_plate()** - 다양한 번호판 형식 지원
3. **find_plate_region()** - 딥러닝 모델 도입 시

---

## 5. 현재 인식 흐름

```
[카메라] → [프레임 캡처] → [전체 이미지 OCR] → [텍스트 병합] → [패턴 매칭] → [결과]
```

### 5.1 지원하는 번호판 패턴

| 패턴 | 예시 | 설명 |
|------|------|------|
| `\d{2,3}[가-힣]\d{4}` | 201누2734 | 신형 번호판 (2019~) |
| `\d{2}[가-힣]\d{4}` | 12가3456 | 구형 번호판 |
| `[가-힣]{2}\d{2}[가-힣]\d{4}` | 서울12가3456 | 지역 포함 |

---

*작성일: 2026-01-09*
